{% extends "_base.html" %}

{% load staticfiles %}

{% block title %}GeoSnapr{% endblock title %}

{% block resources %}
<link href="{% static "slick/slick.css" %}" rel="stylesheet" type='text/css'>
<link href="{% static "slick/slick-theme.css" %}" rel="stylesheet" type='text/css'>
<script src="{% static "infobubble/infobubble.js" %}"></script>
<script src="{% static "js/image.js" %}"></script>
<script src="{% static "js/maps.js" %}"></script>
<script src="{% static "jQuery-fileExif/jquery.exif.js" %}"></script>
<script src="{% static "react/react.js" %}"></script>
<script src="{% static "react/react-with-addons.js" %}"></script>
<script src="{% static "react/react-dom.js" %}"></script>
<script src="{% static "markerclusterer/markerclusterer.js" %}"></script>
{% endblock resources %}

{% block content %}
<div class="mapsize" id="map-canvas">
</div>

<div class="row viewport">
  <div class="columns large-4 top-margin-small">
      <input type="text" id="locationsearch" placeholder="Search..."/>
  </div>
  <div class="columns large-2 large-offset-2 top-margin-small end">
    {% include "__album_select.html" with id="map-albums" %}
  </div>
</div>

<div class="alert-box success" id="message" style="display: none;">
  <a class="close" href="#">Ã—</a>
</div>

<div class="upper-right">
  {% if user.profile.insta_access_key %}
  <a href="{{insta_account_url}}">
    <img src="{% static "img/insta_glyph_colored.png" %}" alt="Instagram" class="oauth-img" data-tooltip aria-haspopup="true" title="View your Instagram app permissions">
  </a>
  {% else %}
  <a href="{{insta_auth_url}}">
    <img src="{% static "img/insta_glyph_colored.png" %}" alt="Instagram" class="oauth-img faded" data-tooltip aria-haspopup="true" title="Link your account to Instagram!">
  </a>
  {% endif %}
  <a href="#" data-reveal-id="editProfileModal" class="button small radius">Edit Profile</a>
  <a href="{%url 'logout' %}" class="button small radius">Logout</a>
</div>

<div class="bottom">
  <a href="#" data-reveal-id="uploadModal" class="button large round bottom-left">Upload New Image</a>
  <a href="#" data-reveal-id="createAlbumModal" class="button round bottom-left">Create New Album</a>
</div>


<!-- Pop-up modals -->

<div id="photo-modal" class="reveal-modal xlarge" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
  <div class="row">
    <div class="columns large-9">
      <img id="photo-modal-link" src="" class="image-fit">
    </div>
    <div class="columns large-3">
      <p id="photo-modal-comment"></p>

      <form id="img-edit-form" action="{% url 'edit_image' %}"method="POST">
      <fieldset class="hidden" id="img-edit-form-hidden">
        <label for="location">Where was this photo taken?
          <input type="text" id="imageeditlocation" name="location" placeholder="Location"/>
        </label>
        <input type="hidden" id="autoeditlat" name="lat"/>
        <input type="hidden" id="autoeditlng" name="lng"/>
        <input type="hidden" id="img-id" name="img_id"/>
        <label for="upload-album">Choose an album for your photo:
          {% include "__album_select.html" with id="upload-album" %}
        </label>
        <label for="caption">Change the caption:
          <input type="text" name="caption" id="editcaption" placeholder="Caption"/>
        </label>
        <button type="submit" class="button" id="edit-img-btn">Edit Image!</button>
      </fieldset>
      </form>

      <a href="#" id="img-edit-form-show">Edit Photo Information</a>
    </div>
  </div>
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

<div id="album-modal" class="reveal-modal xlarge" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
  <div class="row">
    <div class="columns large-9">
      <div class="album-carousel" id="albumcarousel">
      </div>
    </div>
  </div>
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

<div id="uploadModal" class="reveal-modal" data-reveal aria-labelledby="uploadModalTitle" aria-hidden="true" role="dialog">
  <div class="container">
    <div class="row">
      <div class="columns large-12">
        <h2 id="uploadModalTitle">Upload new image</h2>
      </div>
    </div>
    <div class="row">
      <div class="columns large-12">
        <ul class="tabs" data-tab>
          <li class="tab-title active"><a href="#panel1">Local File</a></li>
          <li class="tab-title"><a href="#panel2">Instagram</a></li>
        </ul>
      </div>
    </div>
    <form id="upload-img-form" action="{% url 'upload' %}" method="POST" enctype="multipart/form-data">
      <div class="row">
        {% csrf_token %}
        {# Tabs for the different image upload types #}
        <div class="columns large-6">
          <div class="tabs-content">
            <div class="content active" id="panel1">
              <input type="file" name="pic" class="file-input" id="upload-file">
              <img id="upload-img" />
            </div>
            <div class="content" id="panel2">
              {% if not user.profile.insta_access_key %}
                <a href="{{insta_auth_url}}" id="insta-link">Link your Instagram account now!</a>
              {% endif %}
              <div id="insta-images">
              </div>
            </div>
          </div>
        </div>

        <div class="columns large-6">
          <fieldset class="hidden" id="img-loc-form">
            <label for="location">Where was this photo taken?
              <input type="text" id="imagelocation" name="location" placeholder="Location"/>
            </label>
            <input type="hidden" id="autolat" name="lat" placeholder="Latitude"/>
            <input type="hidden" id="autolng" name="lng" placeholder="Longitude"/>
            <label for="upload-album">Choose an album for your photo:
              {% include "__album_select.html" with id="upload-album" %}
            </label>
            <label for="caption">Caption your new photo!
              <input type="text" name="caption" id="caption" placeholder="Caption"/>
            </label>
            <button type="submit" id="upload-img-btn">Add Image!</button>
          </fieldset>
        </div>
      </div>
    </form>
  </div>
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

<div id="createAlbumModal" class="reveal-modal" data-reveal aria-labelledby="createAlbumTitle" aria-hidden="true" role="dialog">
  <div class="container">
    <div class="row">
      <div class="columns large-12">
        <h2 id="createAlbumTitle">Create New Album</h2>
      </div>
    </div>
    <form id="create-album-form" data-abide="ajax" action="{% url 'create_album' %}" method="POST">
      {% csrf_token %}
      <div class="row">
        <div class="colums large-12">
          <label for="album_name">Album Name:
            <input type="text" id="album-name" name="album_name" value="Untitled Album" required>
          </label>
        </div>
        <div class="row">
          <div class="columns large-12">
            <button type="submit" class="button" id="create-album-btn">Create Album</button>
          </div>
        </div>
      </div>
    </form>
  </div>
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

<div id="editProfileModal" class="reveal-modal" data-reveal aria-labelledby="editModalTitle" aria-hidden="true" role="dialog">
  <div class="container">
    <div class="row">
      <div class="columns large-12">
        <h2 id="editModalTitle">Edit Profile</h2>
        <p class="hidden" id="profile-notification"></p>
      </div>
    </div>
    <form id="edit-profile-form" data-abide="ajax" action="{% url 'edit_profile' %}" method="POST">
      {% csrf_token %}
      <div class="row">
        <div class="input-wrapper columns large-12">
          <label for="first_name">First Name:
            <input type="text" name="first_name" placeholder="First Name" value="{{user.first_name}}" required>
          </label>
          <small class="error">First name is required.</small>
        </div>
      </div>
      <div class="row">
        <div class="input-wrapper columns large-12">
          <label for="last_name">Last Name:
            <input type="text" name="last_name" placeholder="Last Name" value="{{user.last_name}}" required>
          </label>
          <small class="error">Last name is required.</small>
        </div>
      </div>
      <div class="row">
        <div class="input-wrapper columns large-12">
          <label for="email">Email:
            <input type="email" name="email" placeholder="Email" value="{{user.email}}" required>
          </label>
          <small class="error">Email is required.</small>
        </div>
      </div>
      <div class="row">
        <div class="input-wrapper columns large-12">
          <input id="password" type="password" name="password" placeholder="New Password">
        </div>
      </div>
      <div class="row">
        <div class="input-wrapper columns large-12">
          <input type="password" name="confirm_password" placeholder="Confirm New Password" data-equalto="password">
          <small class="error">Passwords must match</small>
        </div>
      </div>

      <div class="row">
        <div class="columns large-10">
          <button type="submit" class="button" id="edit-profile-btn">Save Changes</button>
        </div>
        <div class="columns large-2">
          <a href="#" data-reveal-id="confirmDeleteModal" class="button alert small">Delete Profile</a>
        </div>
      </div>
    </form>
  </div>
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

<div id="confirmDeleteModal" class="reveal-modal" data-reveal aria-labelledby="deleteModalTitle" aria-hidden="true" role="dialog">
  <h2 id="deleteModalTitle">Delete Profile</h2>
  <p>Are you sure you want to delete your profile? This is permanent, and cannot be reverted!</p>
  <a href="{% url 'delete_profile' %}" class="button alert">Delete!</a>
  <a aria-label="Close" class="close-reveal-modal">&#215;</a>
</div>

<script type="text/javascript" src="{% static "slick/slick.js" %}"></script>
<script type="text/javascript" src="{% static "spin/spin.min.js" %}"></script>
{% endblock content %}
